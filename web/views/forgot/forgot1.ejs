<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>AcneSense - Forgot Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      body,
      html {
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
        background-color: #d6ebd5;
        margin: 0;
        padding: 0;
        font-family: "poppins", sans-serif;
      }

      .header-title {
        font-family: "poppins", sans-serif;
        font-weight: 800;
        font-size: 20px;
      }
      .header-subtitle {
        font-family: "maven pro", sans-serif;
        font-size: 14px;
        font-weight: 500;
      }

            .title-font {
        font-family: "manrope", sans-serif;
        font-size: 48px;
        font-weight: 800;
      }
      .sub-title-font {
        font-family: "maven pro", sans-serif;
        font-size: 15px;
        font-weight: 500;
      }
    </style>
  </head>
  <body class="flex justify-center items-center min-h-screen p-0">
    <!-- Mobile version (small screens) -->
    <div class="block md:hidden w-full min-h-screen bg-white mx-auto flex flex-col relative overflow-hidden">
      <!-- Top curve background -->
      <div class="absolute top-0 left-0 w-full h-[150px] bg-gradient-to-b from-[#D6EBD5] to-white rounded-b-[50px] -z-10"></div>
      <div class="absolute top-[-80px] right-[-80px] w-[160px] h-[160px] bg-[#05FF05FF] rounded-full opacity-20 pointer-events-none"></div>
      <div class="absolute bottom-[-100px] left-[-130px] w-[200px] h-[200px] bg-[#03FF03FF] rounded-full opacity-15 pointer-events-none"></div>
      <div class="absolute top-[20%] left-[-40px] w-[80px] h-[80px] bg-[#00FF00FF] rounded-full opacity-10 pointer-events-none"></div>
      <div class="absolute top-[10%] right-[10px] w-[80px] h-[80px] bg-[#00FF00FF] rounded-full opacity-10 pointer-events-none"></div>
      
      <div class="text-center pt-10 pb-2">
        <div class="text-2xl font-extrabold text-black">
          Acne<span class="text-[#40c057]">Sense</span>
        </div>
        <div class="text-xs text-gray-500 mb-5">For Your Acne Solution</div>
      </div>

      <div class="text-center px-6">
        <h1 class="text-xl font-bold mb-2 header-title">Forgot Account</h1>
        <h2 class="text-sm text-gray-600 mb-6 header-subtitle">Tenang Acne Sense dapat membantu mengirimkan OTP untuk lupa password anda</h2>
      </div>

      <div class="px-7 flex flex-col flex-grow">
        <form class="flex flex-col flex-grow">
          <div class="mb-5">
            <label for="email" class="block mb-2 text-gray-800 font-medium text-[15px]">Email</label>
            <input id="email" type="email" placeholder="Masukkan Email" required
              class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[#40c057]" />
            <div class="text-xs text-gray-500 mt-2">OTP hanya berlaku untuk 2 menit</div>
          </div>

          <button type="submit" class="w-full py-4 bg-[#546254] text-white rounded-xl font-semibold text-base hover:bg-[#43543d] transition-colors mt-4">
            Submit
          </button>
        </form>

    
      </div>

      <!-- Bottom curve background -->
      <div class="absolute bottom-0 left-0 w-full h-[150px] bg-gradient-to-t from-[#D6EBD5] to-white rounded-t-[50px] -z-10"></div>
    </div>

    <!-- Desktop / Tablet version (medium screens and up) -->
    <div class="hidden md:flex bg-[#D6EBD5] rounded-3xl shadow-xl overflow-hidden w-full max-w-[1100px] mx-auto">
      <!-- Left panel -->
      <div class="bg-white w-1/2 p-20 flex flex-col justify-center items-center rounded-l-3xl text-center">
        <h1 class="title-font mb-2 leading-6 select-none">
          Acne<span class="text-[#40c057]">Sense</span>
        </h1>
        <p
          class="sub-title-font leading-snug mb-12 select-none text-xl font-semibold"
        >
          For Your Acne Solution
        </p>
        
        <h2 class="text-2xl font-bold mb-4">Forgot Account</h2>
        <p class="text-gray-600 mb-8 px-10">Tenang Acne Sense dapat membantu mengirimkan OTP untuk lupa password anda</p>
        
        <form class="w-full max-w-md space-y-8">
          <div class="flex flex-col text-left text-base">
            <label for="email" class="mb-3 text-black text-lg font-medium">Email</label>
            <input id="email" type="email" placeholder="Masukkan Email" class="border border-gray-400 rounded-lg px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#40c057]" required />
            <p class="text-xs text-gray-500 mt-2">OTP hanya berlaku untuk 2 menit</p>
          </div>

          <button type="submit" class="w-full bg-[#546254] text-white py-3 rounded-lg hover:bg-[#43543d] transition-colors mt-4">
            Submit
          </button>
        </form>
      </div>

      <!-- Right panel -->
      <div class="w-1/2">
        <img src="/image/login.png" alt="Face with acne" class="h-full w-full object-cover" loading="lazy" style="min-height: 600px" />
      </div>
    </div>

    <!-- Status Messages -->
    <div id="message-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 hidden">
      <div id="status-message" class="px-6 py-3 rounded-lg shadow-lg text-white font-medium"></div>
    </div>

    <script>
      // Initialize Supabase client
      const supabase = window.supabase.createClient(
        '<%= process.env.SUPABASE_URL %>',
        '<%= process.env.SUPABASE_KEY %>'
      );

      // Get current domain for redirect URL
      const getCurrentDomain = () => {
        const protocol = window.location.protocol;
        const hostname = window.location.hostname;
        const port = window.location.port;
        
        // For production, use environment-configured site URL if available
        const siteUrl = '<%= process.env.SITE_URL || "" %>';
        if (siteUrl) {
          return siteUrl;
        }
        
        // Fallback to current location
        if (port && port !== '80' && port !== '443') {
          return `${protocol}//${hostname}:${port}`;
        }
        return `${protocol}//${hostname}`;
      };

      // Show status message
      function showMessage(message, isError = false) {
        const messageContainer = document.getElementById('message-container');
        const statusMessage = document.getElementById('status-message');
        
        statusMessage.textContent = message;
        statusMessage.className = `px-6 py-3 rounded-lg shadow-lg font-medium ${
          isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
        }`;
        
        messageContainer.classList.remove('hidden');
        
        setTimeout(() => {
          messageContainer.classList.add('hidden');
        }, 5000);
      }

      // Handle form submission
      document.addEventListener('DOMContentLoaded', function() {
        const forms = document.querySelectorAll('form');
        
        forms.forEach(form => {
          form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = form.querySelector('#email').value.trim();
            const submitButton = form.querySelector('button[type="submit"]');
            
            // Validation
            if (!email) {
              showMessage('Email harus diisi!', true);
              return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
              showMessage('Format email tidak valid!', true);
              return;
            }

            // Disable submit button
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Mengirim...';
            submitButton.disabled = true;

            try {
              // Construct redirect URL
              const redirectUrl = `${getCurrentDomain()}/reset-password`;
              
              const { error } = await supabase.auth.resetPasswordForEmail(email, {
                redirectTo: redirectUrl
              });

              if (error) {
                throw error;
              }

              showMessage('Email reset password telah dikirim! Silakan cek inbox Anda.');
              form.reset();
            } catch (error) {
              console.error('Reset password error:', error);
              
              if (error.message.includes('Email not confirmed')) {
                showMessage('Email belum diverifikasi. Silakan verifikasi email terlebih dahulu.', true);
              } else if (error.message.includes('Invalid email')) {
                showMessage('Email tidak valid!', true);
              } else if (error.message.includes('User not found')) {
                showMessage('Email tidak terdaftar dalam sistem!', true);
              } else {
                showMessage('Gagal mengirim email reset password. Silakan coba lagi.', true);
              }
            } finally {
              // Re-enable submit button
              submitButton.textContent = originalText;
              submitButton.disabled = false;
            }
          });
        });
      });
    </script>
  </body>
</html>
